_format_version: "3.0"
_transform: true

services:
  - name: hello-service
    url: http://127.0.0.1:8080
    routes:
      - name: hello-route
        paths:
          - /hello
  - name: todo-service
    url: http://localhost:9090 # Replace with your actual Spring Boot app URL
    routes:
      - name: todo-route
        paths:
          - /todo
        strip_path: false

plugins:
  - name: rate-limiting
    service: hello-service
    config:
      minute: 10
      policy: local

  - name: key-auth
    service: hello-service
    config:
      key_names:
        - apikey
  - name: oidc
    service: todo-service
    config:
      client_id: kong-client
      client_secret: kong-secret
      discovery: http://keycloak:8080/realms/myrealm/.well-known/openid-configuration
      redirect_uri: http://localhost:9090
      scope: openid
      session_secret: supersecret
      bearer_only: "no"
      filters: ".*"
consumers:
  - username: test-user
    keyauth_credentials:
      - key: my-secret-key